<div class="bulk-actions">
    <ng-content select="vdr-bulk-action-menu"></ng-content>
</div>
<table class="" [class.no-select]="disableSelect" [style.table-layout]="!items?.length ? 'fixed' : 'inherit'">
    <thead [class.items-selected]="selectionManager?.selection.length">
        <tr>
            <th *ngIf="selectionManager" class="align-middle">
                <input
                    type="checkbox"
                    clrCheckbox
                    [checked]="selectionManager?.areAllCurrentItemsSelected()"
                    (change)="onToggleAllClick()"
                />
            </th>
            <th
                *ngFor="let column of visibleColumns; last as isLast"
                class="align-middle"
                [class.expand]="column.expand"
            >
                <div class="cell-content" [ngClass]="column.align">
                    {{ column.heading }}
                </div>
                <div *ngIf="isLast" class="column-picker">
                    <vdr-data-table-colum-picker [columns]="columns?.toArray()"></vdr-data-table-colum-picker>
                </div>
            </th>
        </tr>
        <tr *ngIf="searchTermControl || filters?.length">
            <th [attr.colspan]="visibleColumns.length + (selectionManager ? 1 : 0)" class="filter-row">
                <div class="search-wrapper">
                    <clr-icon shape="search" class="search-icon"></clr-icon>
                    <input [formControl]="searchTermControl" [placeholder]="searchTermPlaceholder" />
                </div>
                <div class="filters">
                    <vdr-data-table-filters
                        *ngFor="let activeFilter of filters.getActiveFilters()"
                        [filter]="activeFilter"
                        [filters]="filters"
                        class="mt-1"
                    ></vdr-data-table-filters>
                    <vdr-data-table-filters
                        *ngIf="filters.length"
                        [filters]="filters"
                        class="mt-1"
                    ></vdr-data-table-filters>
                </div>
            </th>
        </tr>
    </thead>
    <tbody>
        <tr
            *ngFor="
                let item of items
                    | paginate
                        : {
                              itemsPerPage: itemsPerPage,
                              currentPage: currentPage,
                              totalItems: totalItems
                          };
                index as i;
                trackBy: trackByFn
            "
        >
            <td *ngIf="selectionManager" class="selection-col">
                <input
                    type="checkbox"
                    clrCheckbox
                    [checked]="selectionManager?.isSelected(item)"
                    (click)="onRowClick(item, $event)"
                />
            </td>
            <td *ngFor="let column of visibleColumns">
                <div class="cell-content" [ngClass]="column.align">
                    <ng-container
                        *ngTemplateOutlet="column.template; context: { item: item, index: i }"
                    ></ng-container>
                </div>
            </td>
        </tr>
        <ng-container>
            <tr *ngIf="!items?.length">
                <td [attr.colspan]="visibleColumns.length + (selectionManager ? 1 : 0)">
                    <vdr-empty-placeholder [emptyStateLabel]="emptyStateLabel"></vdr-empty-placeholder>
                </td>
            </tr>
        </ng-container>
    </tbody>
</table>
<div class="table-footer ml-4">
    <vdr-items-per-page-controls
        *ngIf="totalItems"
        [itemsPerPage]="itemsPerPage"
        (itemsPerPageChange)="itemsPerPageChange.emit($event)"
    ></vdr-items-per-page-controls>
    <div *ngIf="totalItems" class="p5">
        {{ 'common.total-items' | translate : { currentStart, currentEnd, totalItems } }}
    </div>

    <vdr-pagination-controls
        *ngIf="totalItems"
        [currentPage]="currentPage"
        [itemsPerPage]="itemsPerPage"
        [totalItems]="totalItems"
        (pageChange)="pageChange.emit($event)"
    ></vdr-pagination-controls>
</div>
