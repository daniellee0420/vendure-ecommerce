<vdr-page-header>
    <vdr-page-title>
        <vdr-action-bar-items locationId="zone-list"></vdr-action-bar-items>
        <button
            class="btn btn-primary"
            *vdrIfPermissions="['CreateSettings', 'CreateZone']"
            (click)="create()"
        >
            <clr-icon shape="plus"></clr-icon>
            {{ 'settings.create-new-zone' | translate }}
        </button>
    </vdr-page-title>
</vdr-page-header>
<vdr-page-body>
    <vdr-language-selector
        class="ml-4 mt-2"
        [availableLanguageCodes]="availableLanguages$ | async"
        [currentLanguageCode]="contentLanguage$ | async"
        (languageCodeChange)="setLanguage($event)"
    />
    <vdr-split-view [rightPanelOpen]="activeZone$ | async" (closeClicked)="closeMembers()">
        <ng-template vdrSplitViewLeft>
            <vdr-data-table-2
                class="mt-2"
                id="zone-list"
                [items]="items$ | async"
                [itemsPerPage]="itemsPerPage$ | async"
                [totalItems]="totalItems$ | async"
                [currentPage]="currentPage$ | async"
                [filters]="filters"
                [activeIndex]="activeIndex$ | async"
                (pageChange)="setPageNumber($event)"
                (itemsPerPageChange)="setItemsPerPage($event)"
            >
                <vdr-bulk-action-menu
                    locationId="zone-list"
                    [hostComponent]="this"
                    [selectionManager]="selectionManager"
                />
                <vdr-dt2-search
                    [searchTermControl]="searchTermControl"
                    [searchTermPlaceholder]="'common.search-by-name' | translate"
                />
                <vdr-dt2-column [heading]="'common.id' | translate" [hiddenByDefault]="true">
                    <ng-template let-customerGroup="item">
                        {{ customerGroup.id }}
                    </ng-template>
                </vdr-dt2-column>
                <vdr-dt2-column
                    [heading]="'common.created-at' | translate"
                    [hiddenByDefault]="true"
                    [sort]="sorts.get('createdAt')"
                >
                    <ng-template let-customerGroup="item">
                        {{ customerGroup.createdAt | localeDate : 'short' }}
                    </ng-template>
                </vdr-dt2-column>
                <vdr-dt2-column
                    [heading]="'common.updated-at' | translate"
                    [hiddenByDefault]="true"
                    [sort]="sorts.get('updatedAt')"
                >
                    <ng-template let-customerGroup="item">
                        {{ customerGroup.updatedAt | localeDate : 'short' }}
                    </ng-template>
                </vdr-dt2-column>
                <vdr-dt2-column
                    [heading]="'common.name' | translate"
                    [optional]="false"
                    [sort]="sorts.get('name')"
                >
                    <ng-template let-customerGroup="item">
                        <a class="button-ghost" [routerLink]="['./', customerGroup.id]"
                            ><span>{{ customerGroup.name }}</span>
                            <clr-icon shape="arrow right"></clr-icon>
                        </a>
                    </ng-template>
                </vdr-dt2-column>
                <vdr-dt2-column
                    [heading]="'common.view-contents' | translate"
                    [optional]="false"
                    [sort]="sorts.get('name')"
                >
                    <ng-template let-customerGroup="item">
                        <a
                            class="button-small bg-weight-150"
                            [routerLink]="['./', { contents: customerGroup.id }]"
                            queryParamsHandling="preserve"
                        >
                            <span>{{ 'settings.view-zone-members' | translate }}</span>
                            <clr-icon shape="file-group"></clr-icon>
                        </a>
                    </ng-template>
                </vdr-dt2-column>
            </vdr-data-table-2>
        </ng-template>
        <ng-template vdrSplitViewRight [splitViewTitle]="(activeZone$ | async)?.name">
            <ng-container *ngIf="activeZone$ | async as activeZone">
                <button class="button-ghost ml-4" (click)="addToZone(activeZone)">
                    <clr-icon shape="plus"></clr-icon>
                    <span>{{
                        'settings.add-countries-to-zone' | translate : { zoneName: activeZone.name }
                    }}</span>
                </button>
                <vdr-zone-member-list
                    *ngIf="activeZone$ | async as activeZone"
                    locationId="zone-members-list"
                    [members]="activeZone.members"
                    [selectedMemberIds]="selectedMemberIds"
                    [activeZone]="activeZone"
                    (selectionChange)="selectedMemberIds = $event"
                />
            </ng-container>
        </ng-template>
    </vdr-split-view>
</vdr-page-body>
