<vdr-page-block>
    <vdr-card>
        <div *ngFor="let group of optionGroups; index as i" class="option-groups card-span">
            <vdr-form-field [label]="'catalog.option' | translate">
                <input clrInput [(ngModel)]="group.name" name="name" [readonly]="!group.isNew" />
            </vdr-form-field>
            <vdr-form-field [label]="'catalog.option-values' | translate" class="flex-spacer">
                <vdr-option-value-input
                    #optionValueInputComponent
                    [options]="group.values"
                    [groupName]="group.name"
                    [disabled]="group.name === ''"
                    (add)="addOption(i, $event.name)"
                    (remove)="removeOption(i, $event)"
                ></vdr-option-value-input>
            </vdr-form-field>
            <div>
                <button
                    [disabled]="group.locked"
                    class="button-small mt-4"
                    (click)="removeOptionGroup(group)"
                >
                    <clr-icon shape="trash"></clr-icon>
                </button>
            </div>
        </div>
        <div class="card-span">
            <button class="btn btn-primary-outline btn-sm" (click)="addOptionGroup()">
                <clr-icon shape="plus"></clr-icon>
                {{ 'catalog.create-product-option-group' | translate }}
            </button>
        </div>
    </vdr-card>
    <vdr-card [paddingX]="false">
        <div class="card-span mx-3">
            <button class="button" (click)="createNewVariant()">
                <clr-icon shape="plus"></clr-icon>
                {{ 'catalog.create-new-variant' | translate }}
            </button>
        </div>
        <vdr-data-table-2
            class="card-span"
            id="product-variant-list"
            [items]="variants$ | async"
            [itemsPerPage]="itemsPerPage"
            [totalItems]="totalItems$ | async"
            [currentPage]="currentPage"
            (pageChange)="setPageNumber($event)"
            (itemsPerPageChange)="setItemsPerPage($event)"
        >
            <vdr-bulk-action-menu
                locationId="manage-variants-list"
                [hostComponent]="this"
                [selectionManager]="selectionManager"
            />
            <vdr-dt2-search
                [searchTermControl]="searchTermControl"
                [searchTermPlaceholder]="'catalog.filter-by-name' | translate"
            />
            <vdr-dt2-column [heading]="'common.id' | translate" [hiddenByDefault]="true">
                <ng-template let-variant="item">
                    {{ variant.id }}
                </ng-template>
            </vdr-dt2-column>
            <vdr-dt2-column [heading]="'common.created-at' | translate" [hiddenByDefault]="true">
                <ng-template let-variant="item">
                    {{ variant.createdAt | localeDate : 'short' }}
                </ng-template>
            </vdr-dt2-column>
            <vdr-dt2-column [heading]="'common.updated-at' | translate" [hiddenByDefault]="true">
                <ng-template let-variant="item">
                    {{ variant.updatedAt | localeDate : 'short' }}
                </ng-template>
            </vdr-dt2-column>
            <vdr-dt2-column [heading]="'catalog.name' | translate" [optional]="false">
                <ng-template let-variant="item">
                    {{ variant.name }}
                </ng-template>
            </vdr-dt2-column>
            <vdr-dt2-column [heading]="'catalog.sku' | translate" [optional]="false">
                <ng-template let-variant="item">
                    {{ variant.sku }}
                </ng-template>
            </vdr-dt2-column>
            <vdr-dt2-column *ngFor="let optionGroup of optionGroups$ | async" [heading]="optionGroup.name">
                <ng-template let-variant="item">
                    <vdr-chip
                        *ngIf="getOption(variant, optionGroup.id) as option"
                        [colorFrom]="optionGroup.name"
                        >{{ option.name }}</vdr-chip
                    >
                </ng-template>
            </vdr-dt2-column>
            <vdr-dt2-column [heading]="'common.price' | translate" [hiddenByDefault]="true">
                <ng-template let-variant="item">
                    {{ variant.price | localeCurrency : variant.currencyCode }}
                </ng-template>
            </vdr-dt2-column>
            <vdr-dt2-column [heading]="'common.price-with-tax' | translate" [hiddenByDefault]="true">
                <ng-template let-variant="item">
                    {{ variant.priceWithTax | localeCurrency : variant.currencyCode }}
                </ng-template>
            </vdr-dt2-column>
            <vdr-dt2-column [heading]="'common.delete' | translate" [optional]="false">
                <ng-template let-variant="item">
                    <button class="button-small" (click)="deleteVariant(variant)">
                        <clr-icon shape="trash is-danger"></clr-icon>
                    </button>
                </ng-template>
            </vdr-dt2-column>
        </vdr-data-table-2>
    </vdr-card>
</vdr-page-block>
